import{jsx,jsxs}from"react/jsx-runtime";import{Platform,Appearance,AppState,useWindowDimensions,Pressable,StyleSheet,Text,View,RefreshControl}from"react-native";import{useState,useEffect,useRef,createContext,useContext,useMemo,useCallback,memo,createElement,forwardRef,useImperativeHandle}from"react";import{Gesture,ScrollView,GestureHandlerRootView,GestureDetector}from"react-native-gesture-handler";import{startOfDay}from"date-fns/startOfDay";import{format}from"date-fns/format";import{isAfter}from"date-fns/isAfter";import{isBefore}from"date-fns/isBefore";import{addDays}from"date-fns/addDays";import{getDay}from"date-fns/getDay";import{startOfWeek}from"date-fns/startOfWeek";import{differenceInDays}from"date-fns/differenceInDays";import"date-fns/toDate";import{isSameDay}from"date-fns/isSameDay";import Animated,{useSharedValue,useDerivedValue,withSpring,runOnJS,cancelAnimation,useAnimatedStyle}from"react-native-reanimated";function __awaiter$1(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const useRestoreApp=callback=>{const{appState:appState}=(()=>{const[appState,setAppState]=useState(AppState.currentState);return useEffect((()=>{const subscription=AppState.addEventListener("change",setAppState);return()=>{subscription.remove()}}),[appState]),{appState:appState}})(),lastAppStateRef=useRef(appState);useEffect((()=>{"background"===lastAppStateRef.current&&"active"===appState&&callback(),lastAppStateRef.current=appState}),[appState,callback])},isWeb="web"===Platform.OS;Platform.OS,Platform.OS;const Context$6=createContext(void 0),ThemeProvider=props=>{const scheme=(()=>{const[systemScheme,setSystemScheme]=useState(Appearance.getColorScheme());return useEffect((()=>{const listener=Appearance.addChangeListener((({colorScheme:colorScheme})=>setSystemScheme(colorScheme)));return()=>listener.remove()}),[]),systemScheme})(),theme=useMemo((()=>{var _a;return generateTheme((null===(_a=props.theme)||void 0===_a?void 0:_a.scheme)||scheme||"light",props.theme||{})}),[props.theme,scheme]);return jsx(Context$6.Provider,{value:theme,children:props.children})},useTheme=()=>useContext(Context$6),SchemeColors={light:{background:"#FFFFFF",background1:"#F1F1F1",text:"#000000"},dark:{background:"#000000",background1:"#303030",text:"#FFFFFF"}},generateTheme=(scheme,theme)=>{var _a,_b,_c,_d,_e,_f,_g;const colors=SchemeColors[scheme];return{backgroundColor:(null===(_a=null==theme?void 0:theme[scheme])||void 0===_a?void 0:_a.backgroundColor)||theme.backgroundColor||colors.background,verticalLineColor:(null===(_b=null==theme?void 0:theme[scheme])||void 0===_b?void 0:_b.verticalLineColor)||theme.verticalLineColor||colors.background1,horizontalLineColor:(null===(_c=null==theme?void 0:theme[scheme])||void 0===_c?void 0:_c.horizontalLineColor)||theme.horizontalLineColor||colors.background1,groupHeaderBackgroundColor:(null===(_d=null==theme?void 0:theme[scheme])||void 0===_d?void 0:_d.groupHeaderBackgroundColor)||theme.groupHeaderBackgroundColor||colors.background,groupHeaderTextColor:(null===(_e=null==theme?void 0:theme[scheme])||void 0===_e?void 0:_e.groupHeaderTextColor)||theme.groupHeaderTextColor||colors.text,dayHeaderBackgroundColor:(null===(_f=null==theme?void 0:theme[scheme])||void 0===_f?void 0:_f.dayHeaderBackgroundColor)||theme.dayHeaderBackgroundColor||colors.background,dayHeaderTextColor:(null===(_g=null==theme?void 0:theme[scheme])||void 0===_g?void 0:_g.dayHeaderTextColor)||theme.dayHeaderTextColor||colors.text}};var DirectionOffset;!function(DirectionOffset){DirectionOffset[DirectionOffset.PREV=-1]="PREV",DirectionOffset[DirectionOffset.NEXT=1]="NEXT"}(DirectionOffset||(DirectionOffset={}));const DAY_NUMS=[0,1,2,3,4,5,6],adjustWeekStartsOn=(weekStartsOn=0)=>Math.min(6,Math.round(Math.abs(weekStartsOn))),adjustNumberOfDays=numberOfDays=>numberOfDays?Math.abs(Math.round(numberOfDays)):1;function _extends(){return _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const isDateSatisfyMinDate=(date,minDate)=>!minDate||isAfter(date,minDate)||isSameDay(date,minDate),isDateSatisfyMaxDate=(date,maxDate)=>!maxDate||isBefore(date,maxDate)||isSameDay(date,maxDate),isDateInAllowedRange=(date,minDate,maxDate)=>isDateSatisfyMinDate(date,minDate)&&isDateSatisfyMaxDate(date,maxDate),getSubDates=params=>{const result=[];let date=addDays(params.fromDate,params.ignoreFrom?params.offset:0);for(;result.length<params.numberOfDays;)params.hiddenDays.includes(getDay(date))||result.push(date),date=addDays(date,params.offset);return params.offset===DirectionOffset.PREV?result.reverse():result},getOffsetDate=(offset,params)=>{const followingDate=((fromDate,hiddenDays,offset)=>{let date=addDays(fromDate,offset),i=0;for(;i<7;){if(!hiddenDays.includes(getDay(date)))return date;date=addDays(date,offset),i+=1}throw new Error("No available day of the week found")})(startOfDay(params.date),params.hiddenDays,offset);if((null==params?void 0:params.ignoreLimit)||isDateInAllowedRange(followingDate,params.minDate,params.maxDate))return followingDate},generateCalendarPage=props=>{const groupWeight=1/props.groups.length,dateWeight=1/props.dates.length,groups=props.rtl?props.groups.slice().reverse():props.groups,adjustedDates=props.rtl?props.dates.slice().reverse():props.dates,dateTimes=adjustedDates.map((date=>date.getTime())),dates=groups.flatMap(((group,index)=>{const groupOffset=index*groupWeight,fromDateIndex=index*props.numberOfDays;return adjustedDates.slice(fromDateIndex,fromDateIndex+props.numberOfDays).map(((date,index)=>({date:date,offset:props.fromOffset+groupOffset+index*dateWeight,groupId:group.id})))}));let from=props.fromOffset,to=props.fromOffset;if(props.snappable){if(props.minDate){const offsets=dates.filter((props.rtl,({date:date})=>isDateSatisfyMinDate(date,props.minDate))).map((({offset:offset})=>offset));from=offsets.length?props.rtl?Math.max(...offsets):Math.min(...offsets):null}if(props.maxDate){const offsets=dates.filter((props.rtl,({date:date})=>isDateSatisfyMaxDate(date,props.maxDate))).map((({offset:offset})=>offset));to=offsets.length?props.rtl?Math.min(...offsets):Math.max(...offsets):null}}else props.minDate&&(from=isDateSatisfyMinDate(dates[props.rtl?0:dates.length-1].date,props.minDate)?props.fromOffset:null),props.maxDate&&(to=isDateSatisfyMaxDate(dates[props.rtl?dates.length-1:0].date,props.maxDate)?props.fromOffset:null);return{dates:dates,from:from,to:to,offset:props.fromOffset,maxTime:Math.max(...dateTimes),minTime:Math.min(...dateTimes),groups:groups.map((({id:id})=>id))}},generateInitialCalendarPages=props=>{const initialDates=(params=>{const result=[];if(params.numberOfDays>=5){const sortedDays=[...DAY_NUMS.slice(params.weekStartsOn),...DAY_NUMS.slice(0,params.weekStartsOn)],lastDayNum=sortedDays[sortedDays.length-1],beforeLastDay=sortedDays[sortedDays.length-2],currentDay=getDay(params.fromDate);let start=startOfWeek(params.fromDate,{weekStartsOn:params.weekStartsOn});params.numberOfDays<7&&!params.hiddenDays.length&&(5===params.numberOfDays&&[beforeLastDay,lastDayNum].includes(currentDay)&&(start=addDays(start,currentDay===beforeLastDay?1:2)),6===params.numberOfDays&&lastDayNum===currentDay&&(start=addDays(start,1)));let offset=differenceInDays(start,params.fromDate);for(;offset<0&&result.length<params.numberOfDays;){const prevDate=addDays(params.fromDate,offset);params.hiddenDays.includes(getDay(prevDate))||result.push(prevDate),offset+=1}}return[...result,...result.length<params.numberOfDays?getSubDates(_extends({},params,{numberOfDays:params.numberOfDays-result.length,offset:DirectionOffset.NEXT,ignoreFrom:!1})):[]]})(props),initialPage=generateCalendarPage({fromOffset:props.fromOffset,numberOfDays:props.numberOfDays,rtl:props.rtl,snappable:props.snappable,minDate:props.minDate,maxDate:props.maxDate,groups:props.groups.slice(props.fromGroupIndex,props.fromGroupIndex+props.numberOfGroups),dates:Array.from({length:props.numberOfGroups}).flatMap((()=>initialDates))}),subsequentProps=_extends({},props,{fromPage:initialPage});return[...generatePrevCalendarPage(subsequentProps),initialPage,...generateNextCalendarPage(subsequentProps)]},generatePrevCalendarPage=props=>{const pages=[],totalGroups=props.groups.length-1,indexMultiplier=props.rtl?-1:1,fromDates=props.fromPage.dates,{groupId:groupId}=fromDates[props.rtl?fromDates.length-1:0];let groupIndex=props.groups.slice().reverse().findIndex((({id:id})=>groupId===id));for(let i=0;i<5;i++){const groups=[];for(;groups.length<props.numberOfGroups;){const adjustedIndex=totalGroups-++groupIndex%props.groups.length;groups.unshift({index:adjustedIndex,group:props.groups[adjustedIndex]})}pages.push(generateCalendarPage({fromOffset:props.fromOffset-(i+1)*indexMultiplier,numberOfDays:props.numberOfDays,rtl:props.rtl,snappable:props.snappable,minDate:props.minDate,maxDate:props.maxDate,groups:groups.map((({group:group})=>group)),dates:groups.slice().reverse().reduce(((arr,{index:index})=>{var _pages_at,_pages_at1;const adjustedDates=props.rtl?arr[0]||((null==(_pages_at=pages.at(-1))?void 0:_pages_at.dates)||fromDates).slice().reverse().map((({date:date})=>date)).slice(0,props.numberOfDays):arr[0]||((null==(_pages_at1=pages.at(-1))?void 0:_pages_at1.dates)||fromDates).map((({date:date})=>date)).slice(0,props.numberOfDays);return index!==totalGroups?[adjustedDates,...arr]:[getSubDates({fromDate:adjustedDates[0],hiddenDays:props.hiddenDays,offset:DirectionOffset.PREV,numberOfDays:props.numberOfDays,ignoreFrom:!0}),...arr]}),[]).flat()}))}return pages},generateNextCalendarPage=props=>{const pages=[],indexMultiplier=props.rtl?-1:1,fromDates=props.fromPage.dates,{groupId:groupId}=fromDates[props.rtl?0:fromDates.length-1];let groupIndex=props.groups.findIndex((({id:id})=>groupId===id));for(let i=0;i<5;i++){const groups=[];for(;groups.length<props.numberOfGroups;){const adjustedIndex=++groupIndex%props.groups.length;groups.push({index:adjustedIndex,group:props.groups[adjustedIndex]})}pages.push(generateCalendarPage({fromOffset:props.fromOffset+(i+1)*indexMultiplier,numberOfDays:props.numberOfDays,rtl:props.rtl,snappable:props.snappable,minDate:props.minDate,maxDate:props.maxDate,groups:groups.map((({group:group})=>group)),dates:groups.reduce(((arr,{index:index})=>{var _pages_at,_pages_at1;const adjustedDates=props.rtl?arr.at(-1)||((null==(_pages_at=pages.at(-1))?void 0:_pages_at.dates)||fromDates).slice().reverse().map((({date:date})=>date)).slice(-props.numberOfDays):arr.at(-1)||((null==(_pages_at1=pages.at(-1))?void 0:_pages_at1.dates)||fromDates).map((({date:date})=>date)).slice(-props.numberOfDays);return 0!==index?[...arr,adjustedDates]:[...arr,getSubDates({fromDate:adjustedDates.at(-1),hiddenDays:props.hiddenDays,offset:DirectionOffset.NEXT,numberOfDays:props.numberOfDays,ignoreFrom:!0})]}),[]).flat()}))}return pages};function isObject(value){return"object"==typeof value&&null!==value}function objectsEqual(a,b){if(a===b)return!0;if(a instanceof Date&&b instanceof Date)return a.getTime()===b.getTime();if(!isObject(a)||!isObject(b))return!1;const keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length!==keysB.length)return!1;for(const key of keysA){if(!Object.prototype.hasOwnProperty.call(b,key))return!1;if(!objectsEqual(a[key],b[key]))return!1}return!0}const Context$5=createContext(void 0),DatetimeProvider=({weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,numberOfDays:numberOfDays,minDate:minDate,maxDate:maxDate,locale:locale,dayHeaderTextFormat:dayHeaderTextFormat,children:children})=>{const{now:now,setNow:setNow}=(intervalInSeconds=>{const[now,setNow]=useState(new Date);return useRestoreApp((()=>{setNow(new Date)})),useEffect((()=>{const date=new Date,timeout=setTimeout((()=>setNow(date)),1e3*(60-date.getSeconds()));return()=>clearTimeout(timeout)}),[intervalInSeconds,now]),{now:now,setNow:setNow}})(),hiddenDaysRef=useRef([]),datetime=useMemo((()=>{const hd=(hiddenDays=>hiddenDays?[...new Set(hiddenDays.filter((day=>day<7)))].sort().slice(0,6):[])(hiddenDays);return hd.length===hiddenDaysRef.current.length&&hd.every((day=>hiddenDaysRef.current.includes(day)))||(hiddenDaysRef.current=hd),{weekStartsOn:adjustWeekStartsOn(weekStartsOn),hiddenDays:hiddenDaysRef.current,numberOfDays:adjustNumberOfDays(numberOfDays),minDate:minDate&&startOfDay(minDate),maxDate:maxDate&&startOfDay(maxDate),dayHeaderTextFormat:dayHeaderTextFormat||"EEEEEE dd"}}),[dayHeaderTextFormat,hiddenDays,maxDate,minDate,numberOfDays,weekStartsOn]),formatDate=useCallback(((date,formatSrt)=>format(date,formatSrt,{locale:locale})),[locale]);return jsx(Context$5.Provider,{value:Object.assign(Object.assign({},datetime),{now:now,formatDate:formatDate,setNow:setNow}),children:children})},useDatetime=()=>useContext(Context$5);function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const Context$3=createContext(void 0),ScrollXYProvider=({children:children,scrollXOffset:scrollXOffset})=>{const scrollYRef=useRef(null),scrollYMeasureRef=useRef({x:0,y:0,width:0,height:0}),[scrollableY,setScrollableY]=useState(!0),autoScrolling$=useSharedValue(!1),lastScrollX$=useSharedValue(0),scrollX$=useSharedValue(0),scrollY$=useSharedValue(0),scrolling$=useDerivedValue((()=>autoScrolling$.value||scrollX$.value!==lastScrollX$.value),[]),adjustedScrollX$=useDerivedValue((()=>scrollX$.value+scrollXOffset),[scrollXOffset]),scrollYTo=useCallback((params=>{var _a;null===(_a=scrollYRef.current)||void 0===_a||_a.scrollTo({y:params.value,animated:!!params.animated})}),[]),scrollXTo=useCallback((params=>new Promise((resolve=>{autoScrolling$.value=!0,lastScrollX$.value=params.value,scrollX$.value=withSpring(params.value,params.animated?{velocity:isWeb?void 0:params.velocity,damping:1e3,stiffness:500}:{duration:1},(()=>{runOnJS(resolve)(),autoScrolling$.value=!1}))}))),[]);return jsx(Context$3.Provider,{value:{scrollYRef:scrollYRef,scrollYMeasureRef:scrollYMeasureRef,scrollableY:scrollableY,scrolling$:scrolling$,scrollY$:scrollY$,lastScrollX$:lastScrollX$,scrollX$:scrollX$,adjustedScrollX$:adjustedScrollX$,scrollYTo:scrollYTo,scrollXTo:scrollXTo,setScrollableY:setScrollableY},children:children})},useScrollXY=()=>useContext(Context$3),Context$2=createContext(void 0),NO_GROUP_ENTITY={id:"",name:""},GroupProvider=({children:children,groups:groups,numberOfGroups:numberOfGroups,groupable:groupable})=>{const byIdRef=useRef({}),itemsRef=useRef([]),value=useMemo((()=>{const items=groupable&&groups?groups:[NO_GROUP_ENTITY],byId=items.reduce(((obj,item)=>Object.assign(Object.assign({},obj),{[item.id]:item})),{});return objectsEqual(byIdRef.current,byId)||(byIdRef.current=byId),function(arrA,arrB){if(!Array.isArray(arrA)||!Array.isArray(arrB))return!1;if(arrA.length!==arrB.length)return!1;for(let i=0;i<arrA.length;i++)if(!objectsEqual(arrA[i],arrB[i]))return!1;return!0}(itemsRef.current,items)||(itemsRef.current=items),{byId:byIdRef.current,items:itemsRef.current,numberOfGroups:adjustNumberOfGroups(items.length,numberOfGroups)}}),[groups,groupable,numberOfGroups]);return jsx(Context$2.Provider,{value:value,children:children})},adjustNumberOfGroups=(total,numberOfGroups)=>numberOfGroups?Math.max(Math.min(Math.abs(Math.ceil(numberOfGroups)),total),1):total,useGroup=()=>useContext(Context$2),Context$1=createContext(void 0),CalendarPageProvider=({children:children,selectedDateRef:selectedDateRef,numberOfDays:numberOfDays,minDate:minDate,maxDate:maxDate,weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,snappable:snappable,groupable:groupable,rtl:rtl,setSelectedDate:setSelectedDate})=>{const scroll=useScrollXY(),group=useGroup(),pagesRef=useRef(new Map),offsetsRef=useRef({min:0,max:0,active:0}),[activePages,setActivePages]=useState([]),buffer=useMemo((()=>snappable?2:1),[snappable]),getPagesBuffer=useCallback((offset=>Array.from({length:2*buffer+1}).map(((_,i)=>pagesRef.current.get(i-buffer+Math.floor(offset)))).filter(Boolean)),[buffer]),handleOffset=useCallback((offset=>{const pages=getPagesBuffer(offset);offsetsRef.current={min:Math.min(...pages.map(rtl?({to:to})=>to:({from:from})=>from).filter((value=>null!==value))),max:Math.max(...pages.map(rtl?({from:from})=>from:({to:to})=>to).filter((value=>null!==value))),active:offset},setActivePages(pages)}),[getPagesBuffer,rtl]),initPages=useCallback(((fromDate,fromGroupIndex,params)=>__awaiter(void 0,0,void 0,(function*(){let initOffset=0;const adjustedFromDate=startOfDay(fromDate),initialDate=(null==params?void 0:params.ignoreLimit)?adjustedFromDate:((date,minDate,maxDate)=>minDate&&!isDateSatisfyMinDate(date,minDate)?minDate:maxDate&&!isDateSatisfyMaxDate(date,maxDate)?maxDate:date)(adjustedFromDate,minDate,maxDate),pages=generateInitialCalendarPages({numberOfDays:numberOfDays,numberOfGroups:(null==group?void 0:group.numberOfGroups)||1,weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,rtl:rtl,snappable:snappable,minDate:minDate,maxDate:maxDate,groups:(null==group?void 0:group.items)||[NO_GROUP_ENTITY],fromGroupIndex:fromGroupIndex,fromOffset:initOffset,fromDate:initialDate});if(pagesRef.current.clear(),pages.forEach((page=>pagesRef.current.set(page.offset,page))),snappable&&!groupable){const targetDate=pages[5].dates.find((({date:date})=>isSameDay(initialDate,date)));targetDate&&(initOffset=targetDate.offset)}handleOffset(initOffset),yield null==scroll?void 0:scroll.scrollXTo({value:100*-initOffset,animated:null==params?void 0:params.animated})}))),[minDate,maxDate,numberOfDays,weekStartsOn,hiddenDays,rtl,snappable,groupable,handleOffset,null==group?void 0:group.numberOfGroups,null==group?void 0:group.items]),addPages=useCallback((offset=>{const offsetProps={rtl:rtl,snappable:snappable,minDate:minDate,maxDate:maxDate,numberOfDays:numberOfDays,numberOfGroups:(null==group?void 0:group.numberOfGroups)||1,groups:(null==group?void 0:group.items)||[NO_GROUP_ENTITY],hiddenDays:hiddenDays,fromOffset:offset,fromPage:pagesRef.current.get(offset)};((rtl?offset<0:offset>0)?generateNextCalendarPage(offsetProps):generatePrevCalendarPage(offsetProps)).forEach((page=>pagesRef.current.set(page.offset,page)))}),[rtl,snappable,minDate,maxDate,numberOfDays,hiddenDays,null==group?void 0:group.numberOfGroups,null==group?void 0:group.items]),setOffset=useCallback(((nextOffset,ignoreDateSelection)=>{var _a,_b,_c;const accumulation=((offset,buffer)=>5*Math.floor((Math.abs(offset)+buffer)/5)*(offset<=-5+buffer?-1:1))(nextOffset,buffer);if(pagesRef.current.has(accumulation+5*(nextOffset<0?-1:1))||addPages(accumulation),!ignoreDateSelection&&nextOffset!==offsetsRef.current.active){let nextSelectedDate,dates=null===(_a=pagesRef.current.get(Math.floor(nextOffset)))||void 0===_a?void 0:_a.dates;if(!dates)return;!snappable||snappable&&groupable?(rtl&&(dates=dates.slice().reverse()),nextSelectedDate=null===(_b=dates.find((({date:date,offset:offset})=>offset>=nextOffset&&isDateInAllowedRange(date,minDate,maxDate))))||void 0===_b?void 0:_b.date):nextSelectedDate=null===(_c=dates.find((({date:date,offset:offset})=>offset>=nextOffset&&isDateInAllowedRange(date,minDate,maxDate))))||void 0===_c?void 0:_c.date,nextSelectedDate&&!isSameDay(selectedDateRef.current,nextSelectedDate)&&setSelectedDate(nextSelectedDate)}offsetsRef.current.active!==nextOffset&&handleOffset(nextOffset)}),[addPages,buffer,handleOffset,groupable,maxDate,minDate,rtl,snappable,setSelectedDate]),getActivePages=useCallback((()=>getPagesBuffer(offsetsRef.current.active)),[getPagesBuffer]),getActiveDates=useCallback((()=>getActivePages().flatMap((({dates:dates})=>dates)).filter((({offset:offset})=>rtl&&snappable&&!groupable?offset>offsetsRef.current.active-.99&&offset<=offsetsRef.current.active:offset>=offsetsRef.current.active&&offset<offsetsRef.current.active+.99))),[getActivePages,rtl,snappable,groupable]),toPage=useCallback(((offset,velocity)=>__awaiter(void 0,0,void 0,(function*(){var _a;const{min:min,active:active,max:max}=offsetsRef.current,dates=getActivePages().flatMap((({dates:dates})=>dates));let nextOffset;if(snappable){const targetDateIndex=dates.findIndex((({offset:offset})=>offset.toFixed(3)===active.toFixed(3)));nextOffset=null===(_a=dates[targetDateIndex+offset*(groupable?numberOfDays:1)])||void 0===_a?void 0:_a.offset}else nextOffset=active+offset;void 0===nextOffset?nextOffset=active:nextOffset<min?nextOffset=min:nextOffset>max&&(nextOffset=max),nextOffset!==offsetsRef.current.active&&setOffset(nextOffset),yield null==scroll?void 0:scroll.scrollXTo({value:100*-nextOffset,animated:!0,velocity:velocity})}))),[getActivePages,snappable,groupable,numberOfDays,setOffset]);return useEffect((()=>{initPages(selectedDateRef.current,0)}),[]),jsx(Context$1.Provider,{value:{pagesRef:pagesRef,offsetsRef:offsetsRef,activePages:activePages,initPages:initPages,setOffset:setOffset,toPage:toPage,getActivePages:getActivePages,getActiveDates:getActiveDates},children:children})},useCalendarPage=()=>useContext(Context$1),Context$4=createContext(void 0),minVelocity=isWeb?3e3:500,SwipeCalendarProvider=({blockedByGesture$:blockedByGesture$,children:children,swipeable:swipeable,changeable:changeable,rtl:rtl,snappable:snappable,panWeight:panWeight,widthWeight:widthWeight})=>{const{offsetsRef:offsetsRef,toPage:toPage}=useCalendarPage(),{scrollY$:scrollY$,scrollX$:scrollX$,setScrollableY:setScrollableY,scrollYTo:scrollYTo}=useScrollXY(),panGestureRef=useRef(void 0),scrollXRef=useRef(0),panAxisRef=useRef(void 0),panning$=useSharedValue(!1),panX$=useSharedValue(0),panY$=useSharedValue(0),adjustScrollXPosition=useCallback((e=>{const distance=widthWeight*e.translationX;let moveOffset=0;if(snappable){const scrollXOffset=panWeight/100*-distance;Math.abs(scrollXOffset)%1>.25&&(moveOffset=scrollXOffset>0?Math.ceil(scrollXOffset):Math.floor(scrollXOffset));const absVelocity=Math.abs(e.velocityX),changeByVelocity=Math.ceil(absVelocity/minVelocity)-1,tOffset=e.translationX<0?1:-1;moveOffset=Math.min(panWeight,Math.max(changeByVelocity,Math.abs(moveOffset)))*tOffset}else distance<-10||e.velocityX<-minVelocity?moveOffset=1:(distance>10||e.velocityX>minVelocity)&&(moveOffset=-1);toPage(moveOffset,e.velocityX/10),panAxisRef.current=void 0,scrollXRef.current=0}),[widthWeight,snappable,toPage,panWeight]),panGesture=Gesture.Pan().onBegin((e=>{panning$.value=!0,panX$.value=e.x,panY$.value=e.y})).onStart((e=>{if(panX$.value=e.x,panY$.value=e.y,swipeable&&!(null==blockedByGesture$?void 0:blockedByGesture$.value)){const axis=isWeb&&!(navigator.maxTouchPoints>0)||Math.abs(e.velocityX)>Math.abs(e.velocityY)?"x":"y";panAxisRef.current=axis,"x"===axis&&(runOnJS(setScrollableY)(!1),runOnJS(scrollYTo)({value:scrollY$.value}),cancelAnimation(scrollX$))}})).onChange((e=>{if(1===e.numberOfPointers)if(panX$.value=e.x,panY$.value=e.y,changeable){if("x"===panAxisRef.current){const adjustedScrollX=(props=>{const minScrollX=100*-props.offsets.min,maxScrollX=100*-props.offsets.max;return props.translationX>0&&props.scrollX>minScrollX?minScrollX:props.translationX<0&&props.scrollX<maxScrollX?maxScrollX:props.scrollX})({scrollX:scrollX$.value+e.changeX*widthWeight,translationX:e.translationX,offsets:offsetsRef.current});scrollXRef.current=adjustedScrollX,scrollX$.value=adjustedScrollX}}else scrollXRef.current&&runOnJS(adjustScrollXPosition)(e)})).onFinalize((e=>{panning$.value=!1,"x"===panAxisRef.current&&scrollXRef.current&&!(null==blockedByGesture$?void 0:blockedByGesture$.value)&&(runOnJS(adjustScrollXPosition)(e),runOnJS(scrollYTo)({value:scrollY$.value})),runOnJS(setScrollableY)(!0)})).minDistance(1).withRef(panGestureRef).runOnJS(!0);return jsx(Context$4.Provider,{value:{panning$:panning$,panX$:panX$,panY$:panY$,panGesture:panGesture,panGestureRef:panGestureRef},children:children})},useSwipeCalendar=()=>useContext(Context$4),Context=createContext(void 0),ControlProvider=({children:children,snappable:snappable,groupable:groupable,rtl:rtl,isDayHeaderVisible:isDayHeaderVisible,isGroupHeaderVisible:isGroupHeaderVisible,groups:groups,width:propWidth,dayHeaderHeight:dayHeaderHeight,groupHeaderHeight:groupHeaderHeight,horizontalLineSize:horizontalLineSize})=>{const windowDimensions=useWindowDimensions(),{numberOfDays:numberOfDays}=useDatetime(),{numberOfGroups:numberOfGroups}=useGroup(),adjustedProps=useMemo((()=>{const grouping=!!groupable&&!!(null==groups?void 0:groups.length),headerHeight={group:groupHeaderHeight||30,day:dayHeaderHeight||50},dayHeaderVisible=null==isDayHeaderVisible||isDayHeaderVisible,groupHeaderVisible=grouping&&(null==isGroupHeaderVisible||isGroupHeaderVisible),dateWidth=100/numberOfGroups/numberOfDays;return{snappable:!!snappable,groupable:grouping,rtl:!!rtl,isDayHeaderVisible:dayHeaderVisible,isGroupHeaderVisible:groupHeaderVisible,dateWidth:dateWidth,dateWidthUnit:dateWidth/100,dayHeaderHeight:headerHeight.day,groupHeaderHeight:headerHeight.group,headerHeight:(dayHeaderVisible?headerHeight.day:0)+(groupHeaderVisible?headerHeight.group:0),verticalLineSize:1,horizontalLineSize:Math.max(null!=horizontalLineSize?horizontalLineSize:.5,0)}}),[groupable,null==groups?void 0:groups.length,groupHeaderHeight,dayHeaderHeight,isDayHeaderVisible,isGroupHeaderVisible,snappable,rtl,horizontalLineSize,numberOfGroups,numberOfDays]),adjustedWidth=useMemo((()=>{const width=propWidth||windowDimensions.width;return{width:width,widthWeight:100/width,widthUnit:width/100}}),[propWidth,windowDimensions.width]);return jsx(Context.Provider,{value:Object.assign(Object.assign({},adjustedProps),adjustedWidth),children:children})},useControl=()=>useContext(Context),PageProvider=props=>{const{numberOfDays:numberOfDays,weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,minDate:minDate,maxDate:maxDate}=useDatetime(),{snappable:snappable,groupable:groupable,rtl:rtl}=useControl();return jsx(CalendarPageProvider,Object.assign({},props,{numberOfDays:numberOfDays,minDate:minDate,maxDate:maxDate,weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,snappable:snappable,groupable:groupable,rtl:rtl}))},PanProvider=props=>{const{numberOfDays:numberOfDays}=useDatetime(),{numberOfGroups:numberOfGroups}=useGroup(),{rtl:rtl,snappable:snappable,groupable:groupable,widthWeight:widthWeight}=useControl();return jsx(SwipeCalendarProvider,Object.assign({},props,{changeable:!0,rtl:rtl,snappable:snappable,panWeight:groupable?numberOfGroups:numberOfDays,widthWeight:widthWeight}))},GroupColumn=memo((({blockPress$:blockPress$,rtl:rtl,id:id,name:name,height:height,color:color,backgroundColor:backgroundColor,borderColor:borderColor,borderWidth:borderWidth,render:render,onPress:onPress})=>{const groupId=id;return jsx(Pressable,{disabled:!onPress,style:[styles$4.pressable,Object.assign({height:height,backgroundColor:backgroundColor},!render&&Object.assign({},rtl?{borderRightColor:borderColor,borderRightWidth:borderWidth}:{borderLeftColor:borderColor,borderLeftWidth:borderWidth}))],onPress:()=>{!blockPress$.value&&onPress&&onPress({groupId:groupId})},children:(null==render?void 0:render({groupId:groupId}))||jsx(Text,{numberOfLines:1,style:{color:color},children:name})})})),styles$4=StyleSheet.create({pressable:{flex:1,justifyContent:"center",alignItems:"center"}}),DateColumn=memo((({blockPress$:blockPress$,date:date,groupId:groupId,rtl:rtl,visible:visible,index:index,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,backgroundColor:backgroundColor,sideBorderColor:sideBorderColor,sideBorderWidth:sideBorderWidth,top:top,width:width,height:height,color:color,format:format,formatDate:formatDate,render:render,onPress:onPress})=>{const outProps=Object.assign({date:date},groupId&&{groupId:groupId});return jsx(View,{style:[styles$3.column,Object.assign({top:top,left:width*index+"%",width:`${width}%`},rtl?{borderRightColor:sideBorderColor,borderRightWidth:sideBorderWidth}:{borderLeftColor:sideBorderColor,borderLeftWidth:sideBorderWidth})],children:visible&&jsx(Pressable,{disabled:!onPress,style:{backgroundColor:backgroundColor,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,height:height,borderLeftColor:sideBorderColor,borderLeftWidth:sideBorderWidth,marginTop:-height,marginLeft:-sideBorderWidth},onPress:()=>{!blockPress$.value&&onPress&&onPress(outProps)},children:(null==render?void 0:render(outProps))||jsx(Text,{numberOfLines:1,style:[styles$3.date,{color:color}],children:formatDate(date,format)})})})})),styles$3=StyleSheet.create({column:{position:"absolute",bottom:0},date:{margin:"auto",textTransform:"capitalize"}}),DateContent=memo((({blockPress$:blockPress$,date:date,groupId:groupId,refreshable:refreshable,refreshing:refreshing,scrollable:scrollable,simultaneousHandlers:simultaneousHandlers,render:render,onPress:onPress,onLongPress:onLongPress,onRefresh:onRefresh})=>jsx(ScrollView,{pinchGestureEnabled:!1,bouncesZoom:!1,showsVerticalScrollIndicator:!1,scrollEventThrottle:16,scrollEnabled:scrollable,style:styles$2.view,contentContainerStyle:styles$2.content,simultaneousHandlers:simultaneousHandlers,refreshControl:refreshable?jsx(RefreshControl,{refreshing:refreshing,onRefresh:()=>null==onRefresh?void 0:onRefresh(Object.assign({date:date},groupId&&{groupId:groupId}))}):void 0,children:jsx(Entity,{blockPress$:blockPress$,date:date,groupId:groupId,render:render,onPress:onPress,onLongPress:onLongPress})}))),Entity=memo((({blockPress$:blockPress$,date:date,groupId:groupId,render:render,onPress:onPress,onLongPress:onLongPress})=>{const outProps=Object.assign({date:date},groupId&&{groupId:groupId});return jsx(Pressable,{style:styles$2.view,onPress:()=>{!blockPress$.value&&onPress&&onPress(outProps)},onLongPress:()=>{!blockPress$.value&&onLongPress&&onLongPress(outProps)},children:null==render?void 0:render(outProps)})})),styles$2=StyleSheet.create({view:{flex:1},content:{flexGrow:1}}),Page=({refreshable:refreshable,scrollable:scrollable,refreshing:refreshing,page:page,renderGroupHeader:renderGroupHeader,renderDayHeader:renderDayHeader,renderDay:renderDay,onGroupHeaderPress:onGroupHeaderPress,onDayHeaderPress:onDayHeaderPress,onDayPress:onDayPress,onDayLongPress:onDayLongPress,onRefresh:onRefresh})=>{const{panGestureRef:panGestureRef}=useSwipeCalendar(),{adjustedScrollX$:adjustedScrollX$,scrolling$:scrolling$}=useScrollXY(),{dayHeaderTextFormat:dayHeaderTextFormat,formatDate:formatDate}=useDatetime(),{verticalLineColor:verticalLineColor,horizontalLineColor:horizontalLineColor,groupHeaderBackgroundColor:groupHeaderBackgroundColor,groupHeaderTextColor:groupHeaderTextColor,dayHeaderTextColor:dayHeaderTextColor,dayHeaderBackgroundColor:dayHeaderBackgroundColor}=useTheme(),{byId:byId}=useGroup(),{rtl:rtl,widthUnit:widthUnit,width:width,dateWidth:dateWidth,headerHeight:headerHeight,groupHeaderHeight:groupHeaderHeight,dayHeaderHeight:dayHeaderHeight,verticalLineSize:verticalLineSize,horizontalLineSize:horizontalLineSize,isGroupHeaderVisible:isGroupHeaderVisible,isDayHeaderVisible:isDayHeaderVisible}=useControl(),adjustedScrollable=useMemo((()=>adjustScrollProp(page.dates,scrollable)),[scrollable,page.dates]),adjustedRefreshable=useMemo((()=>adjustScrollProp(page.dates,refreshable)),[refreshable,page.dates]),adjustedRefreshing=useMemo((()=>adjustScrollProp(page.dates,refreshing)),[refreshing,page.dates]),adjustedDates=useMemo((()=>page.dates.map((entity=>{const stringDate=entity.date.toISOString();return Object.assign(Object.assign({},entity),{scrollable:adjustedScrollable[entity.groupId][stringDate],refreshable:adjustedRefreshable[entity.groupId][stringDate],refreshing:adjustedRefreshing[entity.groupId][stringDate]})}))),[adjustedRefreshable,adjustedRefreshing,adjustedScrollable,page.dates]),animatedStyle=useAnimatedStyle((()=>({transform:[{translateX:(100*page.offset+adjustedScrollX$.value)*widthUnit}]})),[widthUnit]);return jsxs(Animated.View,{style:[StyleSheet.absoluteFill,animatedStyle,{width:width,paddingTop:headerHeight}],children:[jsxs(View,{style:styles$1.header,children:[isGroupHeaderVisible&&page.groups.filter((id=>byId[id])).map((id=>jsx(GroupColumn,{blockPress$:scrolling$,rtl:rtl,id:id,name:byId[id].name,height:groupHeaderHeight,color:groupHeaderTextColor,backgroundColor:groupHeaderBackgroundColor,borderColor:verticalLineColor,borderWidth:verticalLineSize,render:renderGroupHeader,onPress:onGroupHeaderPress},id))),page.dates.map(((date,index)=>createElement(DateColumn,Object.assign({},date,{blockPress$:scrolling$,key:`${date.offset}_${date.groupId}_${index}`,index:index,rtl:rtl,visible:isDayHeaderVisible,format:dayHeaderTextFormat,color:dayHeaderTextColor,sideBorderColor:verticalLineColor,sideBorderWidth:verticalLineSize,borderBottomColor:horizontalLineColor,borderBottomWidth:horizontalLineSize,backgroundColor:dayHeaderBackgroundColor,top:headerHeight,width:dateWidth,height:dayHeaderHeight,formatDate:formatDate,onPress:onDayHeaderPress,render:renderDayHeader}))))]}),jsx(View,{style:styles$1.content,children:adjustedDates.map(((date,index)=>createElement(DateContent,Object.assign({},date,{blockPress$:scrolling$,scrollable:date.scrollable,key:`${date.offset}_${date.groupId}_${index}`,simultaneousHandlers:panGestureRef,render:renderDay,onPress:onDayPress,onLongPress:onDayLongPress,onRefresh:onRefresh}))))})]})},adjustScrollProp=(dates,value)=>{if(void 0!==value){if(Array.isArray(value)){const valueObj=value.reduce(((obj,{date:date,groupId:groupId})=>Object.assign(Object.assign({},obj),{[groupId]:Object.assign(Object.assign({},obj[groupId]),{[startOfDay(date).toISOString()]:!0})})),{});return dates.reduce(((obj,{date:date,groupId:groupId})=>{var _a;const key=date.toISOString();return Object.assign(Object.assign({},obj),{[groupId]:Object.assign(Object.assign({},obj[groupId]),{[key]:Boolean(null===(_a=valueObj[groupId])||void 0===_a?void 0:_a[key])})})}),{})}if("object"==typeof value){const valueObj=Object.keys(value).filter((key=>value[key])).reduce(((obj,key)=>Object.assign(Object.assign({},obj),{[startOfDay(key).toISOString()]:!0})),{});return dates.reduce(((obj,{date:date,groupId:groupId})=>{const key=date.toISOString();return Object.assign(Object.assign({},obj),{[groupId]:Object.assign(Object.assign({},obj[groupId]),{[key]:Boolean(valueObj[key])})})}),{})}return dates.reduce(((obj,{date:date,groupId:groupId})=>Object.assign(Object.assign({},obj),{[groupId]:Object.assign(Object.assign({},obj[groupId]),{[date.toISOString()]:value})})),{})}return dates.reduce(((obj,{date:date,groupId:groupId})=>Object.assign(Object.assign({},obj),{[groupId]:Object.assign(Object.assign({},obj[groupId]),{[date.toISOString()]:!1})})),{})},styles$1=StyleSheet.create({view:{position:"absolute",top:0,bottom:0},header:{flex:1,flexDirection:"row",position:"absolute",left:0,top:0,bottom:0,width:"100%"},content:{flex:1,flexDirection:"row"}}),SwipeDay=forwardRef(((props,ref)=>{const selectedDateRef=useRef(props.startDate||new Date),onChangeDebounced=((callback,delay)=>{const timeoutRef=useRef(null),lastArgsRef=useRef(null),debouncedCallback=useCallback((arg=>{lastArgsRef.current=arg,timeoutRef.current&&clearTimeout(timeoutRef.current),timeoutRef.current=setTimeout((()=>{null!==lastArgsRef.current&&callback(lastArgsRef.current)}),delay)}),[callback,delay]);return useEffect((()=>()=>{timeoutRef.current&&clearTimeout(timeoutRef.current)}),[]),debouncedCallback})((date=>{var _a;return null===(_a=props.onChangeDate)||void 0===_a?void 0:_a.call(props,date)}),props.debounceable?500:0),changeDate=useCallback((date=>{const adjustedDate=startOfDay(date);selectedDateRef.current=adjustedDate,onChangeDebounced(adjustedDate)}),[onChangeDebounced]),scrollXOffset=useMemo((()=>{const columnWidth=100/(props.numberOfGroups||1)/(props.numberOfDays||1);return props.snappable&&props.rtl&&!props.groupable?100-columnWidth:0}),[props.groupable,props.numberOfDays,props.numberOfGroups,props.rtl,props.snappable]);return jsx(ThemeProvider,{theme:props.theme,children:jsx(GroupProvider,{groups:props.groups,numberOfGroups:props.numberOfGroups,groupable:props.groupable,children:jsx(DatetimeProvider,{weekStartsOn:props.weekStartsOn,hiddenDays:props.hiddenDays,numberOfDays:props.numberOfDays,minDate:props.minDate,maxDate:props.maxDate,locale:props.locale,dayHeaderTextFormat:props.dayHeaderTextFormat,children:jsx(ControlProvider,{snappable:props.snappable,groupable:props.groupable,rtl:props.rtl,isDayHeaderVisible:props.isDayHeaderVisible,isGroupHeaderVisible:props.isGroupHeaderVisible,groups:props.groups,width:props.width,dayHeaderHeight:props.dayHeaderHeight,groupHeaderHeight:props.groupHeaderHeight,horizontalLineSize:props.horizontalLineSize,children:jsx(ScrollXYProvider,{scrollXOffset:scrollXOffset,children:jsx(PageProvider,{selectedDateRef:selectedDateRef,setSelectedDate:changeDate,children:jsx(PanProvider,{swipeable:!!props.swipeable,children:jsx(SwipeDayBody,{swipeDayRef:ref,selectedDateRef:selectedDateRef,setSelectedDate:changeDate,scrollable:props.scrollable,refreshable:props.refreshable,refreshing:props.refreshing,renderGroupHeader:props.renderGroupHeader,renderDayHeader:props.renderDayHeader,renderDay:props.renderDay,onLoad:props.onLoad,onRefresh:props.onRefresh,onGroupHeaderPress:props.onGroupHeaderPress,onDayHeaderPress:props.onDayHeaderPress,onDayPress:props.onDayPress,onDayLongPress:props.onDayLongPress})})})})})})})})})),SwipeDayBody=({swipeDayRef:swipeDayRef,selectedDateRef:selectedDateRef,setSelectedDate:setSelectedDate,scrollable:scrollable,refreshable:refreshable,refreshing:refreshing,renderGroupHeader:renderGroupHeader,renderDayHeader:renderDayHeader,renderDay:renderDay,onLoad:onLoad,onRefresh:onRefresh,onGroupHeaderPress:onGroupHeaderPress,onDayHeaderPress:onDayHeaderPress,onDayPress:onDayPress,onDayLongPress:onDayLongPress})=>{const rendered=(()=>{const[rendered,setRendered]=useState(!1);return useEffect((()=>{setTimeout((()=>setRendered(!0)),void 0)}),[]),{rendered:rendered}})(),{backgroundColor:backgroundColor}=useTheme(),{hiddenDays:hiddenDays,minDate:minDate,maxDate:maxDate,weekStartsOn:weekStartsOn,numberOfDays:numberOfDays,setNow:setNow}=useDatetime(),{panGesture:panGesture}=useSwipeCalendar(),{width:width,rtl:rtl,snappable:snappable,groupable:groupable}=useControl(),{activePages:activePages,offsetsRef:offsetsRef,pagesRef:pagesRef,initPages:initPages,setOffset:setOffset}=useCalendarPage(),{items:groups,numberOfGroups:numberOfGroups}=useGroup(),{scrollX$:scrollX$,scrolling$:scrolling$,scrollXTo:scrollXTo}=useScrollXY(),loadedRef=useRef(!1),sensitiveRef=useRef({weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,numberOfDays:numberOfDays,snappable:snappable,groupable:groupable,rtl:rtl,numberOfGroups:numberOfGroups,groups:groups}),onLayout=useCallback((()=>{!loadedRef.current&&onLoad&&(loadedRef.current=!0,onLoad())}),[]),reset=useCallback((params=>__awaiter$1(void 0,void 0,void 0,(function*(){setNow(new Date),setSelectedDate(params.date),scrollX$.value=params.offset?100*params.offset:0,yield initPages(params.date,params.groupIndex,params)}))),[setNow,setSelectedDate,initPages]),toOffsetDate=useCallback(((offset,params)=>__awaiter$1(void 0,void 0,void 0,(function*(){if(scrolling$.value)return;const groupIndex=void 0!==(null==params?void 0:params.groupId)?groups.findIndex((({id:id})=>id===params.groupId)):0;if(-1===groupIndex)throw new Error("Unknown group id");const targetGroupId=groups[groupIndex].id,adjustedSide=offset*(rtl?-1:1),adjustedOffset=Math.floor(offsetsRef.current.active),adjustedSelectedDate=startOfDay(selectedDateRef.current),targetDate=Array.from(pagesRef.current.keys()).sort(1===adjustedSide?(a,b)=>a-b:(a,b)=>b-a).filter(1===adjustedSide?offset=>offset>=adjustedOffset:offset=>offset<=adjustedOffset).flatMap((offset=>{var _a;const dates=null===(_a=pagesRef.current.get(offset))||void 0===_a?void 0:_a.dates;return 1===adjustedSide?dates:dates.slice().reverse()})).find(1===offset?({date:date,groupId:groupId})=>groupId===targetGroupId&&isAfter(date,adjustedSelectedDate)&&((null==params?void 0:params.ignoreLimit)||isDateInAllowedRange(date,minDate,maxDate)):({date:date,groupId:groupId})=>groupId===targetGroupId&&isBefore(date,adjustedSelectedDate)&&((null==params?void 0:params.ignoreLimit)||isDateInAllowedRange(date,minDate,maxDate)));if(targetDate){const dateAdjustedOffset=!snappable||groupable?Math.floor(targetDate.offset):targetDate.offset;setSelectedDate(targetDate.date),setOffset(dateAdjustedOffset,!0),yield scrollXTo({value:100*-dateAdjustedOffset,animated:null==params?void 0:params.animated})}else{const followingDate=getOffsetDate(offset,Object.assign(Object.assign({},params),{date:selectedDateRef.current,hiddenDays:hiddenDays,minDate:minDate,maxDate:maxDate}));followingDate&&(yield reset({groupIndex:groupIndex,date:followingDate,offset:adjustedSide,animated:null==params?void 0:params.animated,ignoreLimit:null==params?void 0:params.ignoreLimit}))}}))),[groupable,groups,hiddenDays,maxDate,minDate,reset,rtl,scrollXTo,setOffset,setSelectedDate,snappable]),toSubOffset=useCallback(((offset,params)=>__awaiter$1(void 0,void 0,void 0,(function*(){if(scrolling$.value)return;const page=pagesRef.current.get(Math.floor(offsetsRef.current.active)+offset*(rtl?-1:1));if(!page)return;if(!(null==params?void 0:params.ignoreLimit)){if(1===offset&&maxDate&&!page.dates.some((({date:date})=>isDateSatisfyMaxDate(date,maxDate))))return;if(-1===offset&&minDate&&!page.dates.some((({date:date})=>isDateSatisfyMinDate(date,minDate))))return}const adjustedOffset=(page.offset+offsetsRef.current.active%1*(offsetsRef.current.active>0?1:-1)).toFixed(3),targetDate=page.dates.find((date=>date.offset.toFixed(3)===adjustedOffset));targetDate&&(setOffset(targetDate.offset),yield scrollXTo({value:100*-targetDate.offset,animated:null==params?void 0:params.animated}))}))),[maxDate,minDate,offsetsRef,pagesRef,rtl,scrollXTo,setOffset]);return useImperativeHandle(swipeDayRef,(()=>({getPrevDate:params=>getOffsetDate(-1,Object.assign(Object.assign({},params),{date:selectedDateRef.current,hiddenDays:hiddenDays,minDate:minDate,maxDate:maxDate})),getNextDate:params=>getOffsetDate(1,Object.assign(Object.assign({},params),{date:selectedDateRef.current,hiddenDays:hiddenDays,minDate:minDate,maxDate:maxDate})),prevDate:params=>{toOffsetDate(-1,params)},nextDate:params=>{toOffsetDate(1,params)},back:params=>{toSubOffset(-1,params)},forward:params=>{toSubOffset(1,params)}})),[hiddenDays,maxDate,minDate,toOffsetDate,toSubOffset]),useEffect((()=>{var _a;const ref=sensitiveRef.current;(ref.groupable!==groupable||ref.rtl!==rtl||ref.snappable!==snappable||ref.weekStartsOn!==weekStartsOn||ref.numberOfDays!==numberOfDays||ref.numberOfGroups!==numberOfGroups||(null===(_a=ref.hiddenDays)||void 0===_a?void 0:_a.length)!==(null==hiddenDays?void 0:hiddenDays.length)||ref.hiddenDays&&!ref.hiddenDays.every((day=>null==hiddenDays?void 0:hiddenDays.includes(day)))||ref.groups.length!==groups.length||!ref.groups.every((group=>groups.some((collection=>group.id===collection.id)))))&&(reset({date:selectedDateRef.current,groupIndex:0,offset:0}),sensitiveRef.current={weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,numberOfDays:numberOfDays,snappable:snappable,groupable:groupable,rtl:rtl,numberOfGroups:numberOfGroups,groups:groups})}),[weekStartsOn,hiddenDays,numberOfDays,snappable,groupable,rtl,numberOfGroups,groups,reset]),jsx(GestureHandlerRootView,{children:jsx(GestureDetector,{touchAction:"pan-x",gesture:panGesture,children:jsx(View,{style:[styles.wrapper,{width:width,backgroundColor:backgroundColor}],children:rendered&&!!activePages.length&&jsx(View,{style:styles.view,onLayout:onLayout,children:activePages.map((page=>jsx(Page,{page:page,scrollable:scrollable,refreshable:refreshable,refreshing:refreshing,renderGroupHeader:renderGroupHeader,renderDayHeader:renderDayHeader,renderDay:renderDay,onGroupHeaderPress:onGroupHeaderPress,onDayHeaderPress:onDayHeaderPress,onDayPress:onDayPress,onDayLongPress:onDayLongPress,onRefresh:onRefresh},page.offset)))})})})},"symbiot-swipeday-root")},styles=StyleSheet.create({wrapper:{flex:1,overflow:"hidden",position:"relative"},view:{flex:1}});export{SwipeDay};
